<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AttentionMarket: How Our Ad Auction Works</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.95);
            font-size: 1.3em;
            margin-bottom: 50px;
            font-weight: 300;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h2 {
            color: #667eea;
            font-size: 1.9em;
            margin-bottom: 25px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 12px;
        }

        h3 {
            color: #764ba2;
            font-size: 1.4em;
            margin: 30px 0 15px 0;
        }

        p {
            margin: 15px 0;
            font-size: 1.05em;
            line-height: 1.7;
        }

        .key-insight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .key-insight strong {
            font-size: 1.15em;
        }

        .simple-diagram {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .formula-box {
            background: #fff9e6;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .metric-card h4 {
            font-size: 1.1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .metric-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-card .description {
            font-size: 0.95em;
            opacity: 0.85;
            line-height: 1.5;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }

        .comparison-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
        }

        .comparison-item.winner {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .comparison-item h4 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .comparison-item.winner h4 {
            color: #4caf50;
        }

        .stat-line {
            margin: 10px 0;
            font-size: 1.05em;
        }

        .stat-line strong {
            display: inline-block;
            width: 140px;
        }

        .highlight-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            margin: 25px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 20px;
            margin: 25px 0;
            border-radius: 4px;
        }

        .timeline {
            position: relative;
            padding: 30px 0;
            margin: 30px 0;
        }

        .timeline-item {
            padding: 20px 0 20px 70px;
            position: relative;
            margin-bottom: 10px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 25px;
            top: 0;
            bottom: -10px;
            width: 3px;
            background: #667eea;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: 16px;
            top: 25px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            border: 4px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .timeline-item strong {
            color: #667eea;
            font-size: 1.15em;
        }

        .benefit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .benefit-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 4px;
        }

        .benefit-card h4 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .flywheel-container {
            text-align: center;
            margin: 40px 0;
        }

        .flywheel-steps {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 700px;
            margin: 30px auto;
        }

        .flywheel-step {
            background: white;
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .flywheel-arrow {
            font-size: 3em;
            color: #667eea;
            margin: 20px 0;
        }

        .flywheel-center {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.3em;
            margin: 30px auto;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        ul {
            margin: 15px 0 15px 30px;
            line-height: 1.8;
        }

        ul li {
            margin: 8px 0;
        }

        .final-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
        }

        .final-summary h2 {
            color: white;
            border: none;
            margin-bottom: 20px;
        }

        .final-summary p {
            font-size: 1.2em;
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            .benefit-grid {
                grid-template-columns: 1fr;
            }
            .flywheel-steps {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ AttentionMarket Ad Auction</h1>
        <p class="subtitle">How We Use Quality Scores to Build a Better Ad Marketplace</p>

        <!-- SECTION 1: THE PROBLEM -->
        <div class="section">
            <h2>The Problem We're Solving</h2>

            <p>Traditional ad auctions reward whoever pays the most. This creates poor outcomes:</p>

            <ul>
                <li><strong>Users see irrelevant ads</strong> because high bidders win regardless of quality</li>
                <li><strong>Developers earn less</strong> because low-quality ads have poor click-through rates</li>
                <li><strong>Good advertisers overpay</strong> to compete with spammy ads</li>
                <li><strong>The marketplace degrades</strong> as quality matters less than budget</li>
            </ul>

            <div class="key-insight">
                <strong>Our Solution:</strong> A quality-based auction that rewards relevant, engaging ads ‚Äî not just the highest bidders.
            </div>
        </div>

        <!-- SECTION 2: HOW THE AUCTION WORKS -->
        <div class="section">
            <h2>1. How Our Ad Auction Works</h2>

            <h3>The Core Formula</h3>

            <div class="formula-box">
                <div class="formula">Auction Score = Bid √ó Quality √ó Relevance</div>
                <p style="margin-top: 15px; color: #666;">Highest score wins ‚Äî not highest bid!</p>
            </div>

            <h3>What This Means</h3>

            <p>When a user asks an AI agent a question, we run an auction to decide which ad to show. The winner is determined by three factors:</p>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>üí∞ Bid Amount</h4>
                    <div class="description">How much the advertiser is willing to pay per click</div>
                </div>
                <div class="metric-card">
                    <h4>‚≠ê Quality Score</h4>
                    <div class="description">How well the ad performs (CTR, conversions, user engagement)</div>
                </div>
                <div class="metric-card">
                    <h4>üéØ Relevance</h4>
                    <div class="description">How well the ad matches the user's context (semantic similarity)</div>
                </div>
            </div>

            <h3>Example Auction</h3>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>‚ùå Advertiser A (High Bid, Poor Quality)</h4>
                    <div class="stat-line"><strong>Bid:</strong> $2.50</div>
                    <div class="stat-line"><strong>Quality Score:</strong> 0.3 (poor performance)</div>
                    <div class="stat-line"><strong>Relevance:</strong> 0.9</div>
                    <hr style="margin: 15px 0; border: 1px solid #ddd;">
                    <div class="stat-line"><strong>Auction Score:</strong> 2.50 √ó 0.3 √ó 0.9 = <strong>0.68</strong></div>
                </div>

                <div class="comparison-item winner">
                    <h4>‚úÖ Advertiser B (Lower Bid, High Quality)</h4>
                    <div class="stat-line"><strong>Bid:</strong> $1.80</div>
                    <div class="stat-line"><strong>Quality Score:</strong> 0.9 (excellent performance)</div>
                    <div class="stat-line"><strong>Relevance:</strong> 0.9</div>
                    <hr style="margin: 15px 0; border: 1px solid #ddd;">
                    <div class="stat-line"><strong>Auction Score:</strong> 1.80 √ó 0.9 √ó 0.9 = <strong>1.46</strong></div>
                </div>
            </div>

            <div class="key-insight">
                <strong>Winner: Advertiser B</strong> ‚Äî Even with a 28% lower bid, they win because of superior quality!
            </div>

            <h3>Second-Price Auction</h3>

            <p>The winner doesn't pay their full bid. Instead, they pay just enough to beat the second-place advertiser (plus $0.01).</p>

            <div class="simple-diagram">
<pre>
Second-Place Formula:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
clearingPrice = (2nd place score / winner quality) + $0.01

In our example:
= (0.68 / 0.9) + $0.01
= $0.76

<strong>Advertiser B pays only $0.76 per click</strong>
(Instead of their $1.80 bid!)
</pre>
            </div>

            <div class="highlight-box">
                <strong>üí° Why second-price?</strong> It encourages honest bidding. Since you pay the second-highest price, there's no incentive to underbid strategically. You simply bid your true value.
            </div>
        </div>

        <!-- SECTION 3: QUALITY SCORES -->
        <div class="section">
            <h2>2. Quality Scores: The Key to Better Ads</h2>

            <h3>What Are Quality Scores?</h3>

            <p>Quality scores (0.1 to 1.0) measure how well an ad performs with real users. Every campaign starts at 0.5 and adjusts based on actual results.</p>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>New Campaign</h4>
                    <div class="value">0.5</div>
                    <div class="description">Neutral starting point</div>
                </div>
                <div class="metric-card">
                    <h4>Poor Performance</h4>
                    <div class="value">0.1</div>
                    <div class="description">Low CTR, users ignore</div>
                </div>
                <div class="metric-card">
                    <h4>Good Performance</h4>
                    <div class="value">0.8</div>
                    <div class="description">Solid CTR, users engage</div>
                </div>
                <div class="metric-card">
                    <h4>Excellent Performance</h4>
                    <div class="value">1.0</div>
                    <div class="description">Outstanding CTR, conversions</div>
                </div>
            </div>

            <h3>How We Calculate Quality</h3>

            <p><strong>For Link & Recommendation Ads:</strong> Click-Through Rate (CTR)</p>
            <div class="simple-diagram">
<pre>
Quality Score Calculation:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
CTR = Clicks √∑ Impressions

5% CTR    ‚Üí  1.0 quality (excellent)
2.5% CTR  ‚Üí  0.55 quality (above average)
1% CTR    ‚Üí  0.28 quality (below average)
0% CTR    ‚Üí  0.1 quality (poor)
</pre>
            </div>

            <p><strong>For Service Ads:</strong> Completion Rate (successful API calls √∑ total calls)</p>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Impression Tracking Required</strong><br>
                As of v0.9.0, developers must track impressions to earn revenue. Clicks without prior impressions don't count ‚Äî this ensures accurate quality metrics and prevents gaming the system.
            </div>

            <h3>Updates Happen Daily</h3>

            <p>Every night at midnight UTC, we recalculate quality scores based on the last 30 days of performance data. High-performing ads see their scores rise; poor performers drop.</p>
        </div>

        <!-- SECTION 4: THE FLYWHEEL -->
        <div class="section">
            <h2>3. The Reinforcement Learning Flywheel</h2>

            <h3>How Quality Scores Create a Self-Improving System</h3>

            <p>Quality scores don't just measure performance ‚Äî they <strong>drive</strong> it. Here's how the system gets better over time:</p>

            <div class="flywheel-container">
                <div class="flywheel-steps">
                    <div class="flywheel-step">
                        1Ô∏è‚É£ High-quality ads win more auctions at lower bids
                    </div>
                    <div class="flywheel-step">
                        2Ô∏è‚É£ More impressions & clicks increase their quality scores
                    </div>
                    <div class="flywheel-step">
                        3Ô∏è‚É£ Higher scores make them even more competitive
                    </div>
                    <div class="flywheel-step">
                        4Ô∏è‚É£ Low-quality ads must improve or pay more to compete
                    </div>
                </div>

                <div class="flywheel-arrow">‚ü≤</div>
                <div class="flywheel-center">Quality Reinforcement Loop</div>
            </div>

            <h3>Real Example: 7-Day Campaign Lifecycle</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Day 1:</strong> Campaign launches with 0.5 quality score, $2.00 bid. Wins some auctions.
                </div>
                <div class="timeline-item">
                    <strong>Day 2-7:</strong> Ad performs well ‚Äî 5% CTR, users engage, good conversions.
                </div>
                <div class="timeline-item">
                    <strong>Day 8:</strong> Quality score updated to 0.9 based on strong performance.
                </div>
                <div class="timeline-item">
                    <strong>Day 9+:</strong> Now wins auctions against $2.50 bids (because 2.00 √ó 0.9 = 1.8 beats 2.50 √ó 0.5 = 1.25)
                </div>
                <div class="timeline-item">
                    <strong>Result:</strong> Campaign gets <strong>more traffic at lower cost</strong> because of quality.
                </div>
            </div>

            <h3>The Economic Impact</h3>

            <div class="simple-diagram">
<pre>
Example: $10,000 monthly ad budget

<strong>LOW-QUALITY CAMPAIGN (0.3 quality):</strong>
  ‚Ä¢ Wins ~200 auctions/day
  ‚Ä¢ Gets 6,000 clicks/month
  ‚Ä¢ Cost per click: $1.67
  ‚Ä¢ Poor ROI

<strong>HIGH-QUALITY CAMPAIGN (0.9 quality):</strong>
  ‚Ä¢ Wins ~700 auctions/day
  ‚Ä¢ Gets 21,000 clicks/month
  ‚Ä¢ Cost per click: $0.48
  ‚Ä¢ Excellent ROI

<strong>Result: High-quality campaign gets 3.5√ó more clicks at 71% lower cost</strong>
</pre>
            </div>
        </div>

        <!-- SECTION 5: WHY IT WORKS -->
        <div class="section">
            <h2>4. Why This Creates Better Outcomes</h2>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>üë• For Users</h4>
                    <p>See more relevant, high-quality ads that actually match their needs. Better user experience.</p>
                </div>

                <div class="benefit-card">
                    <h4>üíª For Developers</h4>
                    <p>Higher CTR means more revenue per impression. Quality ads monetize better.</p>
                </div>

                <div class="benefit-card">
                    <h4>üì¢ For Advertisers</h4>
                    <p>Lower cost-per-click for high-quality campaigns. Better ROI incentivizes quality.</p>
                </div>

                <div class="benefit-card">
                    <h4>üöÄ For the Platform</h4>
                    <p>Self-improving system that gets smarter over time. Sustainable competitive advantage.</p>
                </div>
            </div>

            <h3>Incentive Alignment</h3>

            <div class="highlight-box">
                <strong>Everyone benefits from quality:</strong>
                <ul>
                    <li>Advertisers are incentivized to create relevant, engaging ads (lower costs)</li>
                    <li>Developers are incentivized to show ads thoughtfully (higher CTR = more revenue)</li>
                    <li>Users get better experiences (relevant ads instead of spam)</li>
                    <li>The platform gets a data moat (more usage = better targeting = more usage)</li>
                </ul>
            </div>
        </div>

        <!-- SECTION 6: THE DATA MOAT -->
        <div class="section">
            <h2>5. The Data Moat: Semantic Embeddings</h2>

            <h3>How We Build Long-Term Competitive Advantage</h3>

            <p>Every ad decision is powered by <strong>semantic embeddings</strong> ‚Äî 1536-dimensional vectors that capture meaning and context. We store every decision with:</p>

            <ul>
                <li>The user's context (what they said)</li>
                <li>The context embedding (semantic representation)</li>
                <li>Which ad was shown</li>
                <li>Whether the user clicked</li>
                <li>The auction score and quality metrics</li>
            </ul>

            <p>This data compounds into a <strong>flywheel of improvement:</strong></p>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Week 1:</strong> Basic semantic matching, all campaigns at 0.5 quality
                </div>
                <div class="timeline-item">
                    <strong>Month 1:</strong> Quality scores differentiate, best ads get cheaper clicks
                </div>
                <div class="timeline-item">
                    <strong>Month 3:</strong> Context embeddings reveal patterns, targeting improves
                </div>
                <div class="timeline-item">
                    <strong>Month 6+:</strong> Data moat established, ML models optimize matching
                </div>
            </div>

            <div class="key-insight">
                <strong>The more the system runs, the smarter it gets.</strong> More data ‚Üí better targeting ‚Üí more users ‚Üí more data. This is our long-term competitive moat.
            </div>
        </div>

        <!-- FINAL SUMMARY -->
        <div class="final-summary">
            <h2>üéØ Summary: Why This System Works</h2>

            <p>By combining <strong>quality-based auctions</strong>, <strong>second-price bidding</strong>, and <strong>semantic embeddings</strong>, we create a marketplace that:</p>

            <div class="metric-grid" style="margin-top: 30px;">
                <div class="metric-card" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);">
                    <h4>Rewards Quality</h4>
                    <div class="description">Not just the highest bidder</div>
                </div>
                <div class="metric-card" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);">
                    <h4>Self-Improves</h4>
                    <div class="description">Gets better over time automatically</div>
                </div>
                <div class="metric-card" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);">
                    <h4>Aligns Incentives</h4>
                    <div class="description">Everyone wins when ads are relevant</div>
                </div>
                <div class="metric-card" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);">
                    <h4>Builds a Moat</h4>
                    <div class="description">Data compounds into advantage</div>
                </div>
            </div>

            <p style="margin-top: 40px; font-size: 1.25em;">
                <strong>This isn't just an ad auction ‚Äî it's a reinforcement learning system that creates better outcomes for everyone.</strong>
            </p>
        </div>

        <!-- SECTION 7: THE SDK -->
        <div class="section">
            <h2>6. The AttentionMarket SDK: Monetizing AI Agents</h2>

            <h3>What We Built</h3>

            <p>The AttentionMarket SDK enables AI agents and chatbots to earn revenue by displaying contextually relevant ads during conversations. Developers integrate our SDK with 3 lines of code and start earning immediately.</p>

            <div class="key-insight">
                <strong>Core Innovation:</strong> Semantic ad matching powered by the auction system above. When a user asks a question, we run a real-time auction using conversation context to find the most relevant, highest-quality ad.
            </div>

            <h3>Three Ad Types: Link, Recommendation, and Service</h3>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>1. Link Ads (Type 1)</h4>
                    <div class="stat-line"><strong>Format:</strong> Direct click-through offer</div>
                    <div class="stat-line"><strong>Payment:</strong> Per click</div>
                    <div class="stat-line"><strong>Example:</strong> "Progressive - Get 20% off car insurance"</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">Traditional ads optimized for immediate action. User sees title, body, CTA, and click URL.</p>
                </div>

                <div class="comparison-item">
                    <h4>2. Recommendation Ads (Type 2)</h4>
                    <div class="stat-line"><strong>Format:</strong> Conversational teaser</div>
                    <div class="stat-line"><strong>Payment:</strong> Per click</div>
                    <div class="stat-line"><strong>Example:</strong> "Interested in 20% off e-commerce?" ‚Üí "Use code CREATOR20"</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">Conversational ads with optional teaser question, promo code, and link. Payment triggered by clicks, not teaser acceptance.</p>
                </div>
            </div>

            <div class="comparison-item" style="margin-top: 20px; border-color: #2196F3; background: #e7f3ff;">
                <h4>3. Service Ads (Type 3) ‚Äî Agent-to-Agent</h4>
                <div class="stat-line"><strong>Format:</strong> API call to service endpoint</div>
                <div class="stat-line"><strong>Payment:</strong> Per successful completion</div>
                <div class="stat-line"><strong>Example:</strong> Legal AI drafts NDA ‚Üí Developer earns $5 on completion</div>
                <hr style="margin: 15px 0;">
                <p style="margin-top: 10px; font-size: 0.95em;">Agent-to-agent services for tasks like legal document drafting, data analysis, or image generation. Payment only on successful completion.</p>
            </div>

            <h3>How Developers Monetize</h3>

            <div class="simple-diagram">
<pre>
Basic Integration (3 lines of code):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const client = new AttentionMarketClient({
  apiKey: 'am_live_...',
  agentId: 'agt_...'
});

// Get ad based on conversation
const ad = await client.decideFromContext({
  userMessage: "I need car insurance"
});

// Auto-tracking (v0.9.0+): Impression tracked automatically
// Display ad to user:
console.log(ad.creative.title);  // "Progressive - Save 20%"
console.log(ad.creative.body);   // "Compare quotes in 2 minutes"
console.log(ad.creative.cta);    // "Get Quote"

// When user clicks:
await client.trackClickFromAd(ad, {
  click_context: "User clicked Get Quote button"
});
// ‚úì Developer earns money on click
</pre>
            </div>

            <h3>Payment Mechanisms by Ad Type</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Link Ads:</strong> User clicks ‚Üí Developer earns second-price auction clearing price (e.g., $0.76 per click)
                </div>
                <div class="timeline-item">
                    <strong>Recommendation Ads:</strong> User clicks promo link ‚Üí Developer earns clearing price (teaser is optional UX, not payment trigger)
                </div>
                <div class="timeline-item">
                    <strong>Service Ads:</strong> AI calls service endpoint ‚Üí Service completes successfully ‚Üí Developer calls logServiceResult() ‚Üí Developer earns completion payout
                </div>
            </div>

            <h3>Key SDK Design Decisions</h3>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>Auto-Tracking (v0.9.0+)</h4>
                    <p>Impressions tracked automatically when ads are served. Clicks without prior impressions redirect but don't earn revenue ‚Äî prevents fraud.</p>
                </div>

                <div class="benefit-card">
                    <h4>Semantic Context Matching</h4>
                    <p>Developers pass conversation context (user message + history). Backend generates embeddings and matches against campaign intent embeddings using cosine similarity.</p>
                </div>

                <div class="benefit-card">
                    <h4>Second-Price Payouts</h4>
                    <p>Developers earn the auction clearing price (not the winner's bid). Lower fraud risk, higher fill rates, sustainable economics.</p>
                </div>

                <div class="benefit-card">
                    <h4>Click-Based Payment Only</h4>
                    <p>Recommendation ads initially used sentiment analysis (trust-based). We pivoted to click-based payment: 83% code reduction, 50% fewer API calls, zero fraud risk.</p>
                </div>
            </div>

            <h3>Service Ads: Agent-to-Agent Economy</h3>

            <p>Service ads unlock a new business model: AI agents calling other AI agents. Instead of showing links, the SDK returns API endpoints that perform tasks.</p>

            <div class="simple-diagram">
<pre>
Service Ad Flow:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. User: "I need a non-disclosure agreement"

2. Developer calls getService():
   const service = await client.getService({
     taskDescription: "Draft NDA for software contractor"
   });

3. SDK returns service endpoint:
   {
     service_endpoint: "https://legal-ai.com/api/draft-nda",
     service_auth: "Bearer tok_...",
     transaction_id: "txn_12345",
     payout: 5.00  // Earn $5 on completion
   }

4. Developer's AI calls the service:
   const response = await fetch(service.service_endpoint, {
     method: 'POST',
     headers: { 'Authorization': service.service_auth },
     body: JSON.stringify({ task: "Draft NDA", ... })
   });

5. Log completion:
   await client.logServiceResult({
     transaction_id: service.transaction_id,
     success: true
   });
   // ‚úì Developer earns $5, advertiser charged $5.50
</pre>
            </div>

            <h3>Why This Works</h3>

            <div class="highlight-box">
                <strong>Fraud-Proof Revenue Model:</strong>
                <ul>
                    <li><strong>Impressions:</strong> Auto-tracked by SDK (clicks without impressions don't earn revenue)</li>
                    <li><strong>Clicks:</strong> Tracked via server-side redirects (developers can't fake clicks)</li>
                    <li><strong>Service Completions:</strong> Verified by service provider (advertiser confirms success)</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>Critical Deployment Note:</strong> The tracking-redirect function MUST be deployed with --no-verify-jwt flag. End users (not developers) click these URLs ‚Äî they don't have API keys. Without this flag, users get 401 errors.
            </div>

            <h3>Revenue Example: Chatbot Developer</h3>

            <div class="simple-diagram">
<pre>
Scenario: Legal advice chatbot with 10,000 monthly users

<strong>WITHOUT AttentionMarket:</strong>
  ‚Ä¢ Free chatbot, no revenue
  ‚Ä¢ $0/month

<strong>WITH AttentionMarket (Link Ads):</strong>
  ‚Ä¢ 10,000 users ‚Üí 5,000 ad impressions (50% see ads)
  ‚Ä¢ 5% CTR ‚Üí 250 clicks/month
  ‚Ä¢ $0.50 average clearing price
  ‚Ä¢ <strong>$125/month revenue</strong>

<strong>WITH AttentionMarket (Service Ads):</strong>
  ‚Ä¢ 10,000 users ‚Üí 500 legal document requests (5%)
  ‚Ä¢ 80% completion rate ‚Üí 400 successful completions
  ‚Ä¢ $5 average payout
  ‚Ä¢ <strong>$2,000/month revenue</strong>
</pre>
            </div>

            <p style="margin-top: 30px;">Developers earn revenue without charging users. Advertisers get high-intent, contextually relevant placements. Users get helpful suggestions at the exact moment they need them.</p>
        </div>

        <!-- SECTION 8: COMPANY OVERVIEW & USE CASES -->
        <div class="section">
            <h2>7. Welcome to AttentionMarket: What We're Building</h2>

            <h3>The Mission</h3>

            <p>AttentionMarket is building the <strong>ad exchange for the AI era</strong>. We enable developers to monetize AI assistants, chatbots, and agents through contextually relevant advertising ‚Äî without charging users. Our system serves two distinct markets:</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>üì± Market 1: Traditional AI Monetization</h4>
                    <p style="margin-top: 10px;">Chatbots, voice assistants, AI companions, and productivity tools that help users with daily tasks. These apps show contextual ads during conversations.</p>
                    <p style="margin-top: 10px; font-weight: 600;">Revenue model: Developers earn 70% of advertiser spend</p>
                </div>

                <div class="comparison-item">
                    <h4>ü§ñ Market 2: Agent-to-Agent Economy</h4>
                    <p style="margin-top: 10px;">Specialized AI agents that provide services to other AI agents. Instead of clicking ads, one AI calls another AI to complete tasks it can't handle well.</p>
                    <p style="margin-top: 10px; font-weight: 600;">Revenue model: Agent operators earn per call, referrers earn routing fees</p>
                </div>
            </div>

            <h3>Platform Support: Everywhere AI Runs</h3>

            <p>Our HTTP-first API works on any platform that can make an HTTP request. No lock-in, no proprietary SDKs required (though we provide them for convenience).</p>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>üåê Web & Voice</h4>
                    <div class="description">JavaScript, Node.js, Deno, Alexa Skills, Google Actions</div>
                </div>
                <div class="metric-card">
                    <h4>üì± Mobile</h4>
                    <div class="description">iOS (Swift), Android (Kotlin), React Native, Flutter</div>
                </div>
                <div class="metric-card">
                    <h4>üí¨ Messaging</h4>
                    <div class="description">WhatsApp, Discord, Telegram, Slack bots</div>
                </div>
                <div class="metric-card">
                    <h4>üñ•Ô∏è Backend</h4>
                    <div class="description">Python, Node.js, Go, Rust, any HTTP client</div>
                </div>
            </div>

            <h3>Use Case 1: Traditional AI Assistant Monetization</h3>

            <p><strong>Problem:</strong> Developers build free AI assistants but can't monetize without charging users. Subscriptions kill growth. Traditional ad networks don't work for conversational interfaces.</p>

            <p><strong>Solution:</strong> AttentionMarket matches ads to conversation context using semantic search. Developers integrate with one API call, earn $5-$150 per click automatically.</p>

            <div class="simple-diagram">
<pre>
Developer Integration Flow:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. User asks: "I need car insurance"

2. Developer's AI generates response

3. Developer calls AttentionMarket:
   POST /v1/decide
   { "context": "I need car insurance" }

4. AttentionMarket returns ad:
   {
     "status": "filled",
     "units": [{
       "suggestion": {
         "title": "Progressive - Save 20%",
         "body": "Compare quotes in 2 minutes",
         "cta": "Get Quote",
         "tracking_url": "https://.../track-click/..."
       }
     }]
   }

5. Developer shows ad to user (impression auto-tracked)

6. User clicks ‚Üí Redirects via tracking_url ‚Üí Developer earns $0.76
   (Second-price auction clearing price)

<strong>Total integration: 5 lines of code, 100ms latency, $0 setup cost</strong>
</pre>
            </div>

            <h3>Real-World Example: Wedding Planning Assistant</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>User:</strong> "My fianc√© and I are getting married in Austin next summer. Can you help us find a venue?"
                </div>
                <div class="timeline-item">
                    <strong>Assistant Response:</strong> "Congratulations! I can help you find the perfect venue. Austin has amazing options for summer weddings..."
                </div>
                <div class="timeline-item">
                    <strong>AttentionMarket Ad:</strong> [Sponsored] The Driskill Hotel<br>"Host your dream wedding at Austin's most iconic venue. Book a tour today."<br>‚Üí Schedule Tour
                </div>
                <div class="timeline-item">
                    <strong>Result:</strong> User clicks ‚Üí Developer earns $47 ‚Üí User gets personalized venue recommendation
                </div>
            </div>

            <div class="key-insight">
                <strong>Why this works:</strong> The ad appears at the exact moment of intent. Not "after searching 10 venues" ‚Äî at the START of the search. Perfect timing = high conversion = high payouts.
            </div>

            <h3>Use Case 2: Agent-to-Agent Service Exchange</h3>

            <p><strong>Problem:</strong> General AI assistants try to do everything but aren't great at specialized tasks. Wedding planning, legal document drafting, travel booking ‚Äî these need domain expertise.</p>

            <p><strong>Solution:</strong> Specialized agents list their services on AttentionMarket. When a general assistant encounters a task it can't handle well, it calls AttentionMarket with `response_type: "agent"` and gets back an API endpoint to a specialized agent.</p>

            <div class="simple-diagram">
<pre>
Agent-to-Agent Flow:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Developer A: General wedding planning assistant
Developer B: Specialized photographer booking agent

1. User to General Assistant:
   "Find me a wedding photographer in Austin under $3,000"

2. General Assistant realizes it's not specialized for this
   Calls AttentionMarket:
   POST /v1/decide
   {
     "context": "User needs wedding photographer in Austin under $3,000",
     "response_type": "agent"
   }

3. AttentionMarket runs auction, returns Developer B's agent:
   {
     "status": "filled",
     "units": [{
       "agent_name": "WeddingPhoto AI",
       "capability": "Book wedding photographers by location and budget",
       "endpoint": "https://weddingphoto.ai/api/v1/search",
       "input_description": "Send: location, budget, date",
       "output_description": "Returns: photographer name, price, booking URL"
     }]
   }

4. General Assistant calls WeddingPhoto AI:
   POST https://weddingphoto.ai/api/v1/search
   { "location": "Austin", "budget": 3000, "date": "2026-06-15" }

5. WeddingPhoto AI returns:
   {
     "photographer": "Sarah Chen Photography",
     "price": "$2,800",
     "booking_url": "https://sarahchen.com/book/..."
   }

6. General Assistant presents result to user

<strong>Outcome:</strong>
‚Ä¢ Developer A earns routing fee (~$1-2 per call)
‚Ä¢ Developer B earns per call (~$5-10 per successful booking)
‚Ä¢ User gets expert result without switching apps
</pre>
            </div>

            <h3>The Economic Flywheel</h3>

            <div class="flywheel-container">
                <div class="flywheel-steps">
                    <div class="flywheel-step">
                        More developers integrate ‚Üí More ad inventory
                    </div>
                    <div class="flywheel-step">
                        More inventory ‚Üí Advertisers get better ROI
                    </div>
                    <div class="flywheel-step">
                        Better ROI ‚Üí Higher advertiser bids
                    </div>
                    <div class="flywheel-step">
                        Higher bids ‚Üí Developers earn more per click
                    </div>
                </div>

                <div class="flywheel-arrow">‚ü≤</div>
                <div class="flywheel-center">Quality-Based<br>Auction Engine</div>
            </div>

            <h3>Revenue Sharing: Developer Economics</h3>

            <p>Developers earn <strong>70% of advertiser spend</strong>. Payouts happen monthly via Stripe (minimum $100 balance).</p>

            <div class="simple-diagram">
<pre>
Example Monthly Earnings:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>Small chatbot (1,000 monthly users):</strong>
  ‚Ä¢ 500 ad impressions (50% show rate)
  ‚Ä¢ 25 clicks (5% CTR)
  ‚Ä¢ $30 average clearing price
  ‚Ä¢ <strong>Monthly revenue: $525</strong>

<strong>Mid-sized assistant (10,000 monthly users):</strong>
  ‚Ä¢ 5,000 ad impressions
  ‚Ä¢ 250 clicks (5% CTR)
  ‚Ä¢ $40 average clearing price
  ‚Ä¢ <strong>Monthly revenue: $7,000</strong>

<strong>Large platform (100,000 monthly users):</strong>
  ‚Ä¢ 50,000 ad impressions
  ‚Ä¢ 2,500 clicks (5% CTR)
  ‚Ä¢ $50 average clearing price
  ‚Ä¢ <strong>Monthly revenue: $87,500</strong>

<strong>Agent-to-agent specialist (500 monthly calls):</strong>
  ‚Ä¢ 500 service completions
  ‚Ä¢ $10 average payout per completion
  ‚Ä¢ <strong>Monthly revenue: $3,500</strong>
</pre>
            </div>

            <h3>Advertiser Economics: Second-Price Auction Benefits</h3>

            <p>Advertisers bid a maximum price but pay the second-place price + $0.01. This creates honest bidding and efficient markets.</p>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>Pay Less Than You Bid</h4>
                    <p>Bid $2.00, often pay $0.76. Second-price auction = lower average cost per click.</p>
                </div>

                <div class="benefit-card">
                    <h4>Quality Discounts</h4>
                    <p>High-quality ads win at lower bids. 0.9 quality score means 80% more competitive at same bid.</p>
                </div>

                <div class="benefit-card">
                    <h4>Budget Controls</h4>
                    <p>Set daily/monthly caps. Campaign auto-pauses when budget exhausted. No overspending.</p>
                </div>

                <div class="benefit-card">
                    <h4>Full Transparency</h4>
                    <p>Dashboard shows every impression, click, conversion, quality score change, and clearing price.</p>
                </div>
            </div>

            <h3>Critical Technical Requirements</h3>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Impression Tracking (v0.9.0+):</strong> Developers MUST track impressions to earn revenue from clicks. Clicks without prior impressions redirect users but don't charge advertisers or credit developers. This prevents client-side filtering fraud and ensures accurate quality metrics.
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Tracking-Redirect Deployment:</strong> The tracking-redirect Supabase function MUST be deployed with `--no-verify-jwt` flag. End users don't have API keys. Without this flag, all click tracking returns 401 errors.
            </div>

            <h3>What Makes AttentionMarket Different</h3>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>‚ùå Traditional Ad Networks</h4>
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>Banner blindness</li>
                        <li>Intrusive, annoying UX</li>
                        <li>Low CTR (0.1-0.5%)</li>
                        <li>Poor targeting</li>
                        <li>Designed for web pages, not conversations</li>
                    </ul>
                </div>

                <div class="comparison-item winner">
                    <h4>‚úÖ AttentionMarket</h4>
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>Contextual relevance (semantic matching)</li>
                        <li>Natural conversation flow</li>
                        <li>High CTR (3-8%)</li>
                        <li>Quality-based ranking</li>
                        <li>Built for AI assistants and agents</li>
                    </ul>
                </div>
            </div>

            <h3>Growth Roadmap: What We're Building Next</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Q1 2026 (Completed):</strong> Link ads, recommendation ads, second-price auction, quality scoring, impression enforcement
                </div>
                <div class="timeline-item">
                    <strong>Q2 2026 (In Progress):</strong> Service ads (agent-to-agent), conversion-validated bonuses, revenue share for referrals
                </div>
                <div class="timeline-item">
                    <strong>Q3 2026:</strong> Intent-key matching (deterministic agent discovery), advertiser self-serve dashboard, ML-powered targeting improvements
                </div>
                <div class="timeline-item">
                    <strong>Q4 2026:</strong> Multi-ad responses (agent curation), video ads, voice-native ad formats
                </div>
            </div>

            <h3>For New Team Members: What You Need to Know</h3>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>Our Code Philosophy</h4>
                    <p><strong>HTTP-first, not SDK-first.</strong> Every feature must work with raw HTTP. SDKs are convenience wrappers, not requirements. This ensures maximum compatibility across platforms.</p>
                </div>

                <div class="benefit-card">
                    <h4>Our Fraud Prevention</h4>
                    <p><strong>Server-side validation, always.</strong> Never trust client-reported clicks. Use cryptographic tokens, server-side redirects, and atomic database operations to prevent fraud.</p>
                </div>

                <div class="benefit-card">
                    <h4>Our Auction Design</h4>
                    <p><strong>Quality over bid amount.</strong> The auction formula (bid √ó quality √ó relevance) ensures high-quality ads win even at lower bids. This creates better outcomes for everyone.</p>
                </div>

                <div class="benefit-card">
                    <h4>Our Developer Experience</h4>
                    <p><strong>5 lines to revenue.</strong> If integration requires more than 5 lines of code, we failed. Fast, simple, obvious APIs that "just work" are our north star.</p>
                </div>
            </div>

            <h3>Success Metrics We Track</h3>

            <div class="simple-diagram">
<pre>
Platform Health:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>Developer Metrics:</strong>
  ‚Ä¢ Fill rate (% of decide calls that return ads)
  ‚Ä¢ Average payout per click
  ‚Ä¢ Click-through rate (CTR)
  ‚Ä¢ Developer retention (% still active after 90 days)

<strong>Advertiser Metrics:</strong>
  ‚Ä¢ Average quality score by campaign
  ‚Ä¢ Cost per acquisition (CPA)
  ‚Ä¢ Budget utilization rate
  ‚Ä¢ Advertiser retention

<strong>System Metrics:</strong>
  ‚Ä¢ Auction latency (target: <100ms)
  ‚Ä¢ API uptime (target: 99.9%)
  ‚Ä¢ Impression-to-click tracking accuracy
  ‚Ä¢ Quality score distribution

<strong>Business Metrics:</strong>
  ‚Ä¢ Gross Merchandise Value (GMV) - total ad spend
  ‚Ä¢ Take rate (our 30% platform fee)
  ‚Ä¢ Developer revenue per month
  ‚Ä¢ Agent-to-agent call volume
</pre>
            </div>

            <h3>The Long-Term Vision</h3>

            <div class="key-insight">
                <strong>We're building the infrastructure for the agentic economy.</strong>
                <br><br>
                In 5 years, millions of AI agents will collaborate to solve problems. Some will specialize in legal work, others in travel planning, others in creative tasks. AttentionMarket is the marketplace that connects them.
                <br><br>
                Just as Google AdWords connected businesses to searchers, we connect specialized AI agents to general assistants. The difference: instead of humans clicking, it's AI-to-AI service calls ‚Äî faster, more scalable, and infinitely more valuable.
            </div>
        </div>

        <!-- SECTION 9: SMART CONTEXT & TARGETING -->
        <div class="section">
            <h2>8. Smart Context & Targeting (v0.15.0)</h2>

            <h3>The Problem: Basic Semantic Matching Isn't Enough</h3>

            <p>Early versions of AttentionMarket used simple semantic matching: convert user message to embedding, find closest ad. This worked, but missed crucial signals:</p>

            <ul>
                <li>"Compare Pietra vs Shopify" ‚Üí User is in <strong>comparison stage</strong>, ready to decide</li>
                <li>"What's e-commerce?" ‚Üí User is in <strong>research stage</strong>, just learning</li>
                <li>"How do I sign up for Pietra?" ‚Üí User is <strong>ready to buy</strong>, needs transaction URL</li>
            </ul>

            <p>All three queries mention "Pietra" and would get similar semantic scores. But their <strong>intent stages</strong> are completely different ‚Äî and should get different ads.</p>

            <h3>The Solution: Smart Context Detection (v0.15.0)</h3>

            <p>The SDK now automatically detects user intent signals and boosts ad relevance by up to 3x. Three key features:</p>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>üéØ Intent Stage Detection</h4>
                    <div class="description">Auto-detects where users are in their journey: research ‚Üí comparison ‚Üí ready_to_buy</div>
                </div>
                <div class="metric-card">
                    <h4>üß† Interest Extraction</h4>
                    <div class="description">Identifies user interests from conversation context (e.g., "wedding," "photography," "travel")</div>
                </div>
                <div class="metric-card">
                    <h4>üìä Session Tracking</h4>
                    <div class="description">Tracks multi-turn conversations to build user profile over time</div>
                </div>
                <div class="metric-card">
                    <h4>‚ö° Context Boosting</h4>
                    <div class="description">Boosts auction scores for ads matching user signals (capped at +50%)</div>
                </div>
            </div>

            <h3>How It Works: Automatic Detection</h3>

            <div class="simple-diagram">
<pre>
User says: "Compare Pietra vs Shopify for starting an online store"

SDK Auto-Detects:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Intent Stage: 'comparison' (from "Compare X vs Y" pattern)
2. Interests: ['business', 'shopping', 'technology']
3. Purchase Intent: true (action-oriented language)
4. Recent Topics: ['e-commerce', 'platforms']

Backend Auction:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Pietra campaign matches user interests ‚Üí +30% boost
‚Ä¢ User in comparison stage ‚Üí Show comparison-focused ads
‚Ä¢ Pietra's auction score: 2.50 √ó 0.9 √ó 0.9 √ó 1.30 = 2.63
‚Ä¢ Without boost: 2.50 √ó 0.9 √ó 0.9 = 2.03

<strong>Result: Pietra wins auction with 30% higher effective bid</strong>
</pre>
            </div>

            <h3>Performance Impact: Real Numbers</h3>

            <div class="simple-diagram">
<pre>
A/B Test Results (10,000 ad impressions):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>Control (v0.14.2 - No smart context):</strong>
  ‚Ä¢ Click-through rate: 3.8%
  ‚Ä¢ Revenue per impression: $0.19
  ‚Ä¢ Fill rate: 52%

<strong>Treatment (v0.15.0 - Smart context enabled):</strong>
  ‚Ä¢ Click-through rate: 6.3% (+65% improvement)
  ‚Ä¢ Revenue per impression: $0.34 (+78% improvement)
  ‚Ä¢ Fill rate: 48% (-8%, expected trade-off)

<strong>Why it works:</strong>
‚Ä¢ Intent stage matching ‚Üí Better ad timing
‚Ä¢ Interest boosting ‚Üí More relevant ads shown
‚Ä¢ Session tracking ‚Üí Learns from conversation history
</pre>
            </div>

            <h3>Developer Usage: Zero-Config Auto-Detection</h3>

            <p>Smart context works <strong>automatically</strong> with no code changes required. Just use <code>decideFromContext()</code> as before:</p>

            <div class="simple-diagram">
<pre>
// Smart context works automatically (v0.15.0+)
const ad = await client.decideFromContext({
  userMessage: "Compare Pietra vs Shopify",
  conversationHistory: [
    "I want to start selling products online",
    "What platform should I use?"
  ]
});

// SDK automatically extracts:
// - intent_stage: 'comparison'
// - interests: ['business', 'shopping']
// - purchase_intent: true
// - session tracking data
</pre>
            </div>

            <h3>Advanced: Manual Context Hints</h3>

            <p>For apps with existing user profiles, you can provide explicit context for even better targeting:</p>

            <div class="simple-diagram">
<pre>
const ad = await client.decideFromContext({
  userMessage: "What's the best option for me?",

  // Override auto-detected user context
  user_context: {
    interests: ['wedding', 'photography', 'venues'],
    recent_topics: ['Austin venues', 'outdoor weddings'],
    purchase_intent: true
  },

  // Override auto-detected session context
  session_context: {
    session_id: 'session_abc123',  // Track across messages
    message_count: 8,
    intent_stage: 'ready_to_buy'
  }
});
</pre>
            </div>

            <h3>Context Boosting: How Auction Scores Change</h3>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>Without Context Boost (v0.14.2)</h4>
                    <div class="stat-line"><strong>Base Score:</strong> bid √ó quality √ó relevance</div>
                    <div class="stat-line"><strong>Example:</strong> $2.00 √ó 0.9 √ó 0.85 = 1.53</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">All ads ranked purely by bid amount and semantic similarity.</p>
                </div>

                <div class="comparison-item winner">
                    <h4>With Context Boost (v0.15.0)</h4>
                    <div class="stat-line"><strong>Boosted Score:</strong> (bid √ó quality √ó relevance) √ó boost</div>
                    <div class="stat-line"><strong>Example:</strong> $2.00 √ó 0.9 √ó 0.85 √ó 1.30 = 1.99</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">Ads matching user interests/stage get up to +50% boost (capped for auction integrity).</p>
                </div>
            </div>

            <div class="warning-box">
                <strong>Boost Cap (50%):</strong> Context boosts are capped at +50% to maintain auction integrity. This prevents low-quality ads from winning purely due to context matching. Quality and bid amount still matter most.
            </div>

            <h3>Intent Stage Patterns</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Research Stage:</strong> "What is X?", "How does Y work?", "Tell me about Z"<br>
                    ‚Üí Show educational ads, broad comparisons, category leaders
                </div>
                <div class="timeline-item">
                    <strong>Comparison Stage:</strong> "Compare X vs Y", "Which is better?", "Differences between..."<br>
                    ‚Üí Show detailed feature comparisons, pricing tables, trials
                </div>
                <div class="timeline-item">
                    <strong>Ready to Buy:</strong> "How do I sign up?", "What's the price?", "Get started with X"<br>
                    ‚Üí Show direct signup links, special offers, time-limited deals
                </div>
            </div>

            <h3>Privacy & Security</h3>

            <div class="highlight-box">
                <strong>No PII Collection:</strong>
                <ul>
                    <li>Session IDs are opaque hashes (no user identifiers)</li>
                    <li>Interests are topical keywords only (no demographics)</li>
                    <li>Message count is just a number (no message content stored)</li>
                    <li>All data deleted after 90 days</li>
                </ul>
            </div>
        </div>

        <!-- SECTION 10: DEVELOPER CONTROLS -->
        <div class="section">
            <h2>9. Developer Controls & Optimization</h2>

            <p>AttentionMarket provides fine-grained controls over ad quality, revenue, and brand safety. Developers can optimize for maximum earnings or perfect user experience ‚Äî or both.</p>

            <h3>Quality & Brand Safety Controls</h3>

            <h4>1. Minimum Quality Score</h4>

            <p>Filter ads by historical performance. Quality scores (0.0-1.0) are calculated from CTR, conversions, and user feedback.</p>

            <div class="simple-diagram">
<pre>
// Only show high-quality ads (premium app)
const ad = await client.decideFromContext({
  userMessage: "I need legal help",
  minQualityScore: 0.7  // Only ads with 0.7+ quality
});

<strong>Quality Score Ranges:</strong>
‚Ä¢ 0.9-1.0: Excellent (top 10% of advertisers)
‚Ä¢ 0.7-0.9: Good (above average performance)
‚Ä¢ 0.5-0.7: Average (typical performance)
‚Ä¢ 0.3-0.5: Below average (struggling campaigns)
‚Ä¢ 0.1-0.3: Poor (low engagement, likely spam)

<strong>Trade-off:</strong> Higher threshold = better quality but lower fill rate
</pre>
            </div>

            <h4>2. Category Filtering (IAB Taxonomy 3.0)</h4>

            <p>Control which advertiser categories appear using the <strong>IAB Content Taxonomy 3.0</strong> ‚Äî 704 categories across 38 top-level verticals.</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>Allowed Categories (Whitelist)</h4>
                    <div class="simple-diagram" style="margin-top: 10px;">
<pre>
// Wedding app: only wedding-related ads
const ad = await client.decideFromContext({
  userMessage: "Find me a venue",
  allowedCategories: [
    603,  // Weddings
    162,  // Photography
    190   // Restaurants
  ]
});

<strong>Result:</strong> Only ads from these 3
categories shown (blocks everything else)
</pre>
                    </div>
                </div>

                <div class="comparison-item">
                    <h4>Blocked Categories (Blacklist)</h4>
                    <div class="simple-diagram" style="margin-top: 10px;">
<pre>
// Block sensitive content
const ad = await client.decideFromContext({
  userMessage: "Help me with something",
  blockedCategories: [
    601,  // Sensitive Topics (+ children)
    300,  // Gambling
    450   // Adult Content
  ]
});

<strong>Result:</strong> All categories allowed
except these 3 (and their subcategories)
</pre>
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <strong>Parent-Child Hierarchy:</strong> Blocking a parent category automatically blocks all subcategories. For example, blocking category <code>1</code> (Automotive) blocks Auto Insurance (31), Auto Repair (34), Auto Parts (32), etc.
            </div>

            <div class="simple-diagram">
<pre>
Discovering Categories via API:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Get all 38 top-level categories
const tier1 = await client.getCategories({ tier: 1 });
tier1.categories.forEach(cat => {
  console.log(`${cat.id}: ${cat.name}`);
});
// Output: 1: Automotive, 31: Insurance, 150: Travel, etc.

// Get subcategories of "Insurance" (ID: 31)
const insurance = await client.getCategories({ parent_id: 31 });
// Returns: Auto Insurance, Health Insurance, Life Insurance, etc.

// Search for wedding-related categories
const wedding = await client.getCategories({ search: 'wedding' });
// Returns: "Events > Weddings", "Photography > Wedding Photography", etc.
</pre>
            </div>

            <h4>3. Advertiser Blocklist</h4>

            <p>Block specific advertisers (e.g., competitors, low performers, user complaints).</p>

            <div class="simple-diagram">
<pre>
const ad = await client.decideFromContext({
  userMessage: "I need car insurance",
  blockedAdvertisers: ['adv_abc123', 'adv_xyz789']
});

// Advertiser IDs come from ad responses:
if (ad) {
  console.log(ad.advertiser_id);  // "adv_abc123"
}
</pre>
            </div>

            <h3>Revenue Optimization Controls</h3>

            <h4>4. Minimum CPC Filter</h4>

            <p>Only show ads with bids at or above a specified cost-per-click (in cents).</p>

            <div class="simple-diagram">
<pre>
// Premium app: only show $2+ ads
const ad = await client.decideFromContext({
  userMessage: "I need car insurance",
  minCPC: 200  // Only ads bidding >= $2.00 per click
});

<strong>Use Cases:</strong>
‚Ä¢ High-value verticals (legal, insurance): minCPC: 300
‚Ä¢ Premium apps with low traffic: minCPC: 150
‚Ä¢ General apps with high fill rate needs: minCPC: 50

<strong>Trade-off:</strong> Higher threshold = more $ per click but lower fill rate
</pre>
            </div>

            <h4>5. Minimum Relevance Score</h4>

            <p>Only show ads with semantic similarity at or above a threshold (0.0-1.0).</p>

            <div class="simple-diagram">
<pre>
// Niche legal assistant: only highly relevant ads
const ad = await client.decideFromContext({
  userMessage: "Help with estate planning",
  minRelevanceScore: 0.8  // Only ads with 0.8+ semantic match
});

<strong>Relevance Score Ranges:</strong>
‚Ä¢ 0.9-1.0: Perfect match (exact keyword match)
‚Ä¢ 0.8-0.9: Highly relevant (same category)
‚Ä¢ 0.7-0.8: Related (adjacent category)
‚Ä¢ 0.5-0.7: Loosely related
‚Ä¢ 0.25-0.5: Weak connection (backend minimum)

<strong>Note:</strong> Only applies to semantic campaigns (not keyword campaigns)
</pre>
            </div>

            <h4>6. Ranking Strategy</h4>

            <p>Choose how ads are ranked when multiple ads match.</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>Revenue Mode (Default)</h4>
                    <div class="stat-line"><strong>Ranking:</strong> bid √ó quality √ó relevance</div>
                    <div class="stat-line"><strong>Winner pays:</strong> Just enough to beat 2nd place + $0.01</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">Maximizes revenue. Highest composite score wins.</p>
                </div>

                <div class="comparison-item">
                    <h4>Relevance Mode</h4>
                    <div class="stat-line"><strong>Ranking:</strong> Semantic similarity only</div>
                    <div class="stat-line"><strong>Winner pays:</strong> Just enough to beat 2nd place + $0.01</div>
                    <hr style="margin: 15px 0;">
                    <p style="margin-top: 10px; font-size: 0.95em;">Prioritizes best match. Perfect for niche apps.</p>
                </div>
            </div>

            <div class="simple-diagram">
<pre>
// Revenue mode (default): highest bid wins
const ad = await client.decideFromContext({
  userMessage: "I need legal help",
  optimizeFor: 'revenue'
});

// Relevance mode: best semantic match wins
const ad = await client.decideFromContext({
  userMessage: "I need legal help",
  optimizeFor: 'relevance'
});

<strong>Important:</strong> Winner never pays more than their max bid (price cap)
<strong>Price floor:</strong> Minimum clearing price of $0.25 (platform sustainability)
</pre>
            </div>

            <h4>Combining Controls for Precision</h4>

            <p>Mix multiple controls to create sophisticated targeting strategies:</p>

            <div class="simple-diagram">
<pre>
// Premium legal assistant: only perfect-match, high-quality, high-value ads
const ad = await client.decideFromContext({
  userMessage: "I need estate planning help",

  // Quality & Brand Safety
  minQualityScore: 0.8,         // Only excellent advertisers
  allowedCategories: [318],     // Legal services only
  blockedAdvertisers: competitors,

  // Revenue Optimization
  minCPC: 300,                  // Only $3+ bids
  minRelevanceScore: 0.85,      // Only highly relevant
  optimizeFor: 'relevance'      // Best match wins
});

<strong>Result:</strong> Hyper-targeted ads with high revenue and perfect UX
<strong>Trade-off:</strong> Low fill rate (15-25%), but 3x higher revenue per impression
</pre>
            </div>

            <h3>Performance Optimization: Minimal Payload Format</h3>

            <p>As of v0.14.0, the SDK uses a minimal response format by default ‚Äî reducing payload size by <strong>84% (3.2KB ‚Üí 520 bytes)</strong>.</p>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>üöÄ Minimal (Default)</h4>
                    <div class="value">520B</div>
                    <div class="description">Essentials only: creative, click_url, tracking_token, relevance_score. Auto-tracks impressions.</div>
                </div>
                <div class="metric-card">
                    <h4>üìã Standard</h4>
                    <div class="value">645B</div>
                    <div class="description">Adds disclosure info. Manual impression tracking required.</div>
                </div>
                <div class="metric-card">
                    <h4>üìä Verbose</h4>
                    <div class="value">3.1KB</div>
                    <div class="description">Full response with all metadata. For debugging and analytics.</div>
                </div>
            </div>

            <div class="simple-diagram">
<pre>
Minimal Format Response (Default):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
{
  creative: { title, body, cta },
  click_url: "https://...",
  tracking_token: "trk_abc",
  advertiser_id: "adv_123",
  payout: 76,  // cents
  relevance_score: 0.87
}

<strong>Benefits:</strong>
‚Ä¢ 6x less data transfer (520B vs 3.2KB)
‚Ä¢ Faster parsing and rendering
‚Ä¢ Lower mobile bandwidth usage
‚Ä¢ Automatic impression tracking
</pre>
            </div>

            <h3>Real-World Configuration Examples</h3>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>General Chatbot</h4>
                    <p><strong>Goal:</strong> Maximize revenue, high fill rate</p>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
minQualityScore: 0.5
minCPC: 25
optimizeFor: 'revenue'

Fill rate: 60%
Revenue/click: $0.45
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Premium Legal Assistant</h4>
                    <p><strong>Goal:</strong> Perfect UX, brand safety</p>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
minQualityScore: 0.8
allowedCategories: [318]
minRelevanceScore: 0.85
optimizeFor: 'relevance'

Fill rate: 18%
Revenue/click: $3.20
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Wedding Planning App</h4>
                    <p><strong>Goal:</strong> Category-specific, high quality</p>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
minQualityScore: 0.7
allowedCategories: [603, 162, 190]
minCPC: 100

Fill rate: 42%
Revenue/click: $1.85
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Kids Education App</h4>
                    <p><strong>Goal:</strong> Block inappropriate content</p>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
minQualityScore: 0.6
blockedCategories: [601, 300, 450]
minCPC: 50

Fill rate: 55%
Revenue/click: $0.62
</pre>
                    </div>
                </div>
            </div>

            <h3>Fill Rate vs Revenue Trade-offs</h3>

            <div class="simple-diagram">
<pre>
Configuration Impact Analysis:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>No filters (baseline):</strong>
  Fill rate: 65% | Avg revenue/click: $0.42 | Monthly: $5,460

<strong>Add minQualityScore: 0.7:</strong>
  Fill rate: 48% (-26%) | Avg revenue/click: $0.58 (+38%) | Monthly: $5,568 (+2%)

<strong>Add minCPC: 100:</strong>
  Fill rate: 35% (-27%) | Avg revenue/click: $0.89 (+53%) | Monthly: $6,230 (+12%)

<strong>Add minRelevanceScore: 0.8:</strong>
  Fill rate: 22% (-37%) | Avg revenue/click: $1.24 (+39%) | Monthly: $5,456 (-12%)

<strong>Insight:</strong> Quality + CPC filters increase revenue. Relevance filter decreases it
(fewer ads qualify, but those that do aren't necessarily higher-paying).
</pre>
            </div>

            <div class="key-insight">
                <strong>Best Practice:</strong> Start with no filters. Monitor fill rate and CTR for 2 weeks. Then add filters incrementally, measuring impact. Most profitable config: <code>minQualityScore: 0.7</code> + <code>minCPC: 50-100</code> + smart context auto-detection.
            </div>
        </div>

        <!-- SECTION 11: BACKEND ARCHITECTURE -->
        <div class="section">
            <h2>10. Backend Architecture: How It All Works</h2>

            <h3>Technology Stack</h3>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>üóÑÔ∏è Database</h4>
                    <div class="description">PostgreSQL with pgvector extension for vector similarity search</div>
                </div>
                <div class="metric-card">
                    <h4>‚ö° Edge Functions</h4>
                    <div class="description">Deno runtime on Supabase for serverless compute</div>
                </div>
                <div class="metric-card">
                    <h4>ü§ñ AI/ML</h4>
                    <div class="description">OpenAI text-embedding-ada-002 for semantic embeddings (1536 dimensions)</div>
                </div>
                <div class="metric-card">
                    <h4>üîí Security</h4>
                    <div class="description">Row-Level Security (RLS), circuit breakers, rate limiting, distributed locks</div>
                </div>
            </div>

            <h3>The Decide Pipeline: From Request to Response</h3>

            <p>When a developer calls <code>decideFromContext()</code>, here's what happens under the hood (100ms total):</p>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Step 1: Request Validation (5ms)</strong><br>
                    Validate API key, check rate limits, parse request parameters, extract user context
                </div>
                <div class="timeline-item">
                    <strong>Step 2: Query Enrichment (10ms)</strong><br>
                    Auto-detect intent stage, extract interests, analyze emotional tone, calculate decision momentum
                </div>
                <div class="timeline-item">
                    <strong>Step 3: Embedding Generation (40ms)</strong><br>
                    Generate 3 embeddings: current need, full context, intent-only. Check cache first (95% hit rate)
                </div>
                <div class="timeline-item">
                    <strong>Step 4: Vector Search (25ms)</strong><br>
                    Query pgvector for top 20 candidates using cosine similarity, apply quality/CPC/category filters
                </div>
                <div class="timeline-item">
                    <strong>Step 5: Auction Execution (10ms)</strong><br>
                    Rank ads by composite score, calculate second-price clearing price, select winner
                </div>
                <div class="timeline-item">
                    <strong>Step 6: Response Assembly (10ms)</strong><br>
                    Create tracking token, store auction result, return minimal/standard/verbose format
                </div>
            </div>

            <h3>Query Enrichment: Backend Intelligence (Zero SDK Changes)</h3>

            <p>The backend automatically extracts signals from every request without requiring SDK updates. This is the "secret sauce" that makes ads 65% more relevant.</p>

            <div class="simple-diagram">
<pre>
User Message: "I'm so frustrated with my current e-commerce platform"

Backend Auto-Detects:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>Emotional Signals:</strong>
  ‚Ä¢ emotional_tone: 'frustrated' (from keyword matching)
  ‚Ä¢ urgency_level: 'high' (implied from frustration)

<strong>Query Classification:</strong>
  ‚Ä¢ query_type: 'support' (help-seeking language)
  ‚Ä¢ mentioned_brands: ['shopify', 'wix'] (if in conversation history)
  ‚Ä¢ price_sensitive: true (if price mentioned in history)

<strong>Decision Momentum:</strong>
  ‚Ä¢ Base: 0.3
  ‚Ä¢ +0.1 (query_type = support)
  ‚Ä¢ +0.1 (urgency_level = high)
  ‚Ä¢ +0.1 (frustrated users want solutions)
  ‚Ä¢ +0.1 (messageCount > 5)
  ‚Ä¢ <strong>Final: 0.7 (ready to switch!)</strong>

<strong>Journey Stage:</strong>
  ‚Ä¢ Momentum > 0.7 ‚Üí 'deciding' stage
  ‚Ä¢ Show decision-focused ads (trials, demos, guarantees)
</pre>
            </div>

            <h3>Multi-Embedding Strategy</h3>

            <p>Instead of generating one embedding, we generate three different embeddings for better matching:</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h4>Current Need Embedding</h4>
                    <p style="margin-top: 10px;"><strong>Input:</strong> User's current message only</p>
                    <p><strong>Purpose:</strong> Match immediate, explicit needs</p>
                    <p><strong>Example:</strong> "I need car insurance" ‚Üí vector representing car insurance urgency</p>
                </div>

                <div class="comparison-item">
                    <h4>Full Context Embedding</h4>
                    <p style="margin-top: 10px;"><strong>Input:</strong> Current message + last 3 history messages</p>
                    <p><strong>Purpose:</strong> Capture broader conversation context</p>
                    <p><strong>Example:</strong> "...new car...move to Texas...need insurance" ‚Üí vector capturing relocation context</p>
                </div>
            </div>

            <div class="comparison-item" style="margin-top: 20px; border-color: #2196F3; background: #e7f3ff;">
                <h4>Intent-Only Embedding</h4>
                <p style="margin-top: 10px;"><strong>Input:</strong> Extracted core intent (noise words removed)</p>
                <p><strong>Purpose:</strong> Match pure intent without conversational fluff</p>
                <p><strong>Example:</strong> "Can you please help me find car insurance?" ‚Üí "find car insurance"</p>
            </div>

            <h3>Embedding Cache: 95% Hit Rate</h3>

            <p>Generating embeddings costs $0.0001 per 1000 tokens. At scale, this adds up fast. The backend caches embeddings using SHA256 hashes:</p>

            <div class="simple-diagram">
<pre>
Embedding Cache Logic:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Hash input text: SHA256("I need car insurance") ‚Üí abc123...
2. Check cache: SELECT embedding FROM embedding_cache WHERE text_hash = 'abc123...'
3. If HIT (95%): Return cached embedding (0ms, $0 cost)
4. If MISS (5%): Generate new embedding (40ms, $0.0001 cost)
5. Store in cache with TTL = 24 hours
6. Auto-cleanup: Keep only 10,000 most recently used

<strong>Cost Savings:</strong>
‚Ä¢ Without cache: 1M requests √ó $0.0001 = $100/day
‚Ä¢ With cache (95% hit): 50K requests √ó $0.0001 = $5/day
‚Ä¢ <strong>Savings: $95/day or 95% reduction</strong>
</pre>
            </div>

            <h3>Production-Critical Fixes (Google Staff Engineer Review)</h3>

            <p>In February 2026, we conducted a senior staff engineer review and implemented 15 production-critical fixes. These are the most important for new team members to understand:</p>

            <h4>1. Circuit Breaker Pattern</h4>

            <div class="simple-diagram">
<pre>
Problem: OpenAI API goes down ‚Üí All requests fail ‚Üí Retry storm ‚Üí Even worse
Solution: Circuit breaker tracks failures and "opens" after threshold

Circuit Breaker States:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>CLOSED (Normal):</strong>
  ‚Ä¢ All requests pass through
  ‚Ä¢ Track failure count
  ‚Ä¢ If failures >= 5 ‚Üí OPEN

<strong>OPEN (Failing):</strong>
  ‚Ä¢ Block all requests immediately
  ‚Ä¢ Return cached results or fallback
  ‚Ä¢ Wait 60 seconds ‚Üí HALF_OPEN

<strong>HALF_OPEN (Testing):</strong>
  ‚Ä¢ Allow 3 test requests
  ‚Ä¢ If success ‚Üí CLOSED
  ‚Ä¢ If failure ‚Üí OPEN (wait another 60s)

<strong>Result: 99.9% uptime even when OpenAI is down</strong>
</pre>
            </div>

            <h4>2. Rate Limiting (Multi-Layer)</h4>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>API Key Level</h4>
                    <p><strong>Limit:</strong> 100 req/min per API key</p>
                    <p>Prevents single developer from overwhelming the system</p>
                </div>

                <div class="benefit-card">
                    <h4>IP Level</h4>
                    <p><strong>Limit:</strong> 60 req/min per IP</p>
                    <p>Prevents DDoS attacks from single source</p>
                </div>

                <div class="benefit-card">
                    <h4>OpenAI Level</h4>
                    <p><strong>Limit:</strong> 60 req/min, 150K tokens/min</p>
                    <p>Stays within OpenAI rate limits to avoid 429 errors</p>
                </div>

                <div class="benefit-card">
                    <h4>Cost Level</h4>
                    <p><strong>Limit:</strong> $100/day OpenAI spend</p>
                    <p>Circuit-breaker fallback if daily budget exceeded</p>
                </div>
            </div>

            <h4>3. Distributed Locks for Budget Updates</h4>

            <div class="simple-diagram">
<pre>
Problem: Race Condition
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Thread A: Read budget_spent = $90, budget = $100
Thread B: Read budget_spent = $90, budget = $100
Thread A: Write budget_spent = $95 (charged $5)
Thread B: Write budget_spent = $93 (charged $3, overwrites A!)
<strong>Result: Lost $5 charge, advertiser underbilled</strong>

Solution: Distributed Lock with Atomic Update
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Thread A: acquire_lock('campaign_123') ‚Üí SUCCESS
Thread B: acquire_lock('campaign_123') ‚Üí WAIT...
Thread A: UPDATE budget_spent = budget_spent + 5 WHERE id = '123'
Thread A: release_lock('campaign_123')
Thread B: acquire_lock('campaign_123') ‚Üí SUCCESS
Thread B: UPDATE budget_spent = budget_spent + 3 WHERE id = '123'
Thread B: release_lock('campaign_123')
<strong>Result: Both charges recorded correctly</strong>

<strong>Implementation: safe_increment_campaign_budget() function</strong>
‚Ä¢ 3 retry attempts with exponential backoff
‚Ä¢ Automatic lock expiration after 5 seconds
‚Ä¢ Budget validation before update
</pre>
            </div>

            <h4>4. Dead Letter Queue (DLQ)</h4>

            <p>When operations fail (e.g., OpenAI timeout, database deadlock), they go to the DLQ for automatic retry instead of being lost.</p>

            <div class="simple-diagram">
<pre>
DLQ Flow:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Operation fails (e.g., enrich_campaign)
2. Insert into dead_letter_queue:
   {
     operation: 'enrich_campaign',
     payload: { campaign_id: '123' },
     error_message: 'OpenAI timeout',
     retry_after: NOW() + 5 minutes,
     error_count: 1
   }

3. Background worker checks DLQ every minute:
   SELECT * FROM dead_letter_queue
   WHERE status = 'pending' AND retry_after < NOW()

4. Retry operation:
   ‚Ä¢ Success ‚Üí status = 'completed'
   ‚Ä¢ Failure ‚Üí error_count++, retry_after += exponential_backoff

5. After 5 failures ‚Üí status = 'failed', alert team

<strong>Result: Zero data loss, automatic recovery from transient errors</strong>
</pre>
            </div>

            <h4>5. Request Deduplication</h4>

            <div class="highlight-box">
                <strong>Problem:</strong> User double-clicks "Get Ad" button ‚Üí Two identical requests ‚Üí Two charges ‚Üí Advertiser angry
                <br><br>
                <strong>Solution:</strong> Hash request parameters (campaign_id + timestamp), check if processed in last 10 seconds
                <br><br>
                <strong>Implementation:</strong>
                <ul style="margin-top: 10px;">
                    <li>Generate request hash: SHA256(campaign_id + operation + timestamp)</li>
                    <li>Check idempotency_keys table: Was this processed recently?</li>
                    <li>If YES ‚Üí Return cached response (429 status)</li>
                    <li>If NO ‚Üí Process request, store hash with TTL=10s</li>
                </ul>
            </div>

            <h3>Database Schema: Key Tables</h3>

            <div class="simple-diagram">
<pre>
Core Tables:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>campaigns</strong>
  ‚Ä¢ Advertiser campaigns with budgets, bids, targeting
  ‚Ä¢ metadata_v2: Enriched data (problem_statement, buyer_stages, embeddings)
  ‚Ä¢ quality_score: Updated daily based on performance (0.1-1.0)
  ‚Ä¢ Budget tracking: budget, budget_spent (atomic updates only)

<strong>ad_units</strong>
  ‚Ä¢ Creative content: title, body, cta, action_url
  ‚Ä¢ Ad type specific fields: teaser, promo_code (recommendation), service_endpoint (service)
  ‚Ä¢ Linked to campaigns via campaign_id FK

<strong>click_tracking_tokens</strong>
  ‚Ä¢ Fraud-proof click tracking
  ‚Ä¢ tracking_token (UUID), campaign_id, ad_unit_id, clearing_price_cents
  ‚Ä¢ expires_at: 24-hour TTL for security

<strong>auction_results</strong>
  ‚Ä¢ Second-price auction analytics
  ‚Ä¢ winner_auction_score, second_auction_score, clearing_price
  ‚Ä¢ Used for optimizing auction algorithm

<strong>quality_score_history</strong>
  ‚Ä¢ Daily snapshots of campaign quality scores
  ‚Ä¢ CTR, conversion rate, user feedback metrics
  ‚Ä¢ Used by update-quality-scores cron job

Supporting Tables (Production Safeguards):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ embedding_cache: LRU cache for OpenAI embeddings (95% hit rate)
‚Ä¢ api_rate_limits: Per-minute request/token tracking
‚Ä¢ circuit_breakers: Service health monitoring (OpenAI, external APIs)
‚Ä¢ distributed_locks: Prevent race conditions on budget updates
‚Ä¢ dead_letter_queue: Failed operation retry queue
‚Ä¢ error_logs: Comprehensive error tracking with stack traces
‚Ä¢ api_cost_tracking: OpenAI spend monitoring ($100/day limit)
‚Ä¢ system_metrics: Performance metrics (latency, fill rate, CTR)
‚Ä¢ idempotency_keys: Request deduplication (10s TTL)
</pre>
            </div>

            <h3>Supabase Edge Functions</h3>

            <h4>decide-enhanced Function (Main Ad Serving)</h4>

            <div class="simple-diagram">
<pre>
Route: POST /functions/v1/decide
Auth: X-AM-API-Key header
Timeout: 30s with AbortSignal
Rate Limit: 100 req/min per API key

Core Logic:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Validate API key and rate limits
2. Extract SDK context (interests, intent_stage, session_id)
3. Enrich query (emotional_tone, urgency, decision_momentum)
4. Generate 3 embeddings (current, context, intent)
5. Vector search: pgvector cosine similarity
6. Apply developer controls (quality, CPC, category filters)
7. Rank ads (revenue or relevance mode)
8. Second-price auction (winner pays 2nd place + $0.01)
9. Store auction result for analytics
10. Return minimal/standard/verbose response

<strong>Performance:</strong>
‚Ä¢ p50: 85ms
‚Ä¢ p95: 120ms
‚Ä¢ p99: 200ms
</pre>
            </div>

            <h4>enrich-campaign Function (Campaign Metadata Enrichment)</h4>

            <div class="simple-diagram">
<pre>
Route: POST /functions/v1/enrich-campaign
Auth: Service role key (admin only)
Purpose: Extract structured intent from campaign descriptions

Core Logic:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. Acquire distributed lock (prevent concurrent enrichment)
2. Check if recently enriched (< 24 hours ago)
3. Call GPT-3.5-turbo to extract:
   ‚Ä¢ problem_statement, value_proposition
   ‚Ä¢ use_cases, buyer_stages
   ‚Ä¢ emotional_triggers, urgency_triggers
   ‚Ä¢ target_interests, price_sensitivity
4. Generate 4 embeddings:
   ‚Ä¢ Problem embedding
   ‚Ä¢ Solution embedding
   ‚Ä¢ Audience embedding
   ‚Ä¢ Use cases embedding
5. Store in campaigns.metadata_v2 JSONB column
6. Release lock
7. Log success metrics

<strong>Safeguards:</strong>
‚Ä¢ Circuit breaker for OpenAI (5 failure threshold)
‚Ä¢ Rate limiting (60 req/min)
‚Ä¢ Cost tracking ($100/day limit)
‚Ä¢ Dead letter queue on failure
‚Ä¢ Embedding cache (avoid re-enriching)
‚Ä¢ Distributed lock (one enrichment at a time per campaign)
</pre>
            </div>

            <h3>Production Monitoring Dashboard</h3>

            <div class="simple-diagram">
<pre>
SELECT * FROM production_dashboard;
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<strong>Live Metrics:</strong>

Active Campaigns                       47
Budget Utilization %                   67.3
API Calls (Last Hour)                  12,450
OpenAI Cost Today ($)                  $8.42
Errors (Last Hour)                     3
Circuit Breakers Open                  0

<strong>Health Check:</strong>

SELECT * FROM system_health_check();
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
database               healthy  {"connections": 23}
circuit_breaker_openai healthy  {"state": "closed", "failures": 0}
rate_limits            healthy  {"requests_per_minute": 45}
budget_burn_rate       healthy  {"campaigns_near_limit": 2}
</pre>
            </div>

            <h3>Critical Deployment Notes</h3>

            <div class="warning-box">
                <strong>‚ö†Ô∏è BEFORE DEPLOYING TO PRODUCTION:</strong>
                <ol style="margin-top: 10px;">
                    <li><strong>Set environment variables:</strong>
                        <ul>
                            <li><code>OPENAI_API_KEY</code> - Required for embeddings</li>
                            <li><code>OPENAI_DAILY_LIMIT_USD</code> - Default: $100</li>
                            <li><code>MAX_REQUESTS_PER_MINUTE</code> - Default: 60</li>
                            <li><code>SUPABASE_SERVICE_ROLE_KEY</code> - For bypassing RLS</li>
                        </ul>
                    </li>
                    <li><strong>Run migrations in order:</strong>
                        <ul>
                            <li>20260228005215_add_enhanced_matching_production.sql</li>
                            <li>20260228005247_add_production_safeguards.sql</li>
                        </ul>
                    </li>
                    <li><strong>Deploy functions with correct flags:</strong>
                        <ul>
                            <li><code>supabase functions deploy decide-enhanced</code></li>
                            <li><code>supabase functions deploy enrich-campaign</code></li>
                            <li><code>supabase functions deploy tracking-redirect --no-verify-jwt</code> (CRITICAL!)</li>
                        </ul>
                    </li>
                    <li><strong>Set up cron jobs:</strong>
                        <ul>
                            <li>Cleanup job: <code>SELECT cleanup_all_old_data()</code> - Daily at midnight</li>
                            <li>Quality score update: <code>SELECT update_all_quality_scores()</code> - Daily at 2am</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <h3>Debugging Tips for New Team Members</h3>

            <div class="benefit-grid">
                <div class="benefit-card">
                    <h4>Check Circuit Breaker State</h4>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
SELECT * FROM circuit_breakers;

If state = 'open':
‚Ä¢ OpenAI is down or rate limited
‚Ä¢ System using cached embeddings
‚Ä¢ Wait 60s for automatic recovery
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Check Recent Errors</h4>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
SELECT * FROM error_logs
WHERE created_at > NOW() - INTERVAL '1 hour'
ORDER BY created_at DESC;

Look for patterns:
‚Ä¢ Many 'RATE_LIMIT_EXCEEDED' ‚Üí Traffic spike
‚Ä¢ Many 'OPENAI_TIMEOUT' ‚Üí OpenAI slow
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Check Dead Letter Queue</h4>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
SELECT * FROM dead_letter_queue
WHERE status = 'pending'
ORDER BY last_error_at DESC;

Failed operations awaiting retry.
Investigate if error_count > 3.
</pre>
                    </div>
                </div>

                <div class="benefit-card">
                    <h4>Check Cost Tracking</h4>
                    <div class="simple-diagram" style="margin-top: 10px; padding: 10px; font-size: 0.85em;">
<pre>
SELECT
  SUM(cost_usd) as total_cost,
  SUM(tokens_used) as total_tokens
FROM api_cost_tracking
WHERE created_at >= date_trunc('day', NOW());

If approaching $100 limit:
‚Ä¢ Circuit breaker will open automatically
‚Ä¢ Investigate embedding cache hit rate
</pre>
                    </div>
                </div>
            </div>

            <h3>Why This Architecture Matters</h3>

            <div class="key-insight">
                <strong>Production-Ready from Day One</strong>
                <br><br>
                This isn't a prototype. Every component is designed for scale:
                <ul style="margin-top: 10px;">
                    <li><strong>Fault Tolerance:</strong> Circuit breakers, DLQ, automatic retries</li>
                    <li><strong>Cost Control:</strong> Embedding cache (95% hit rate), daily spend limits, rate limiting</li>
                    <li><strong>Data Integrity:</strong> Distributed locks, atomic updates, request deduplication</li>
                    <li><strong>Observability:</strong> Error logs, metrics, health checks, production dashboard</li>
                    <li><strong>Performance:</strong> Sub-100ms p95 latency, pgvector for fast similarity search</li>
                </ul>
                <br>
                We built this to handle 100M requests/day from the start. That's why every decision is deliberate.
            </div>
        </div>
    </div>
</body>
</html>